# GitHub Global - 快速启动说明

本文档将帮助您在本地环境快速启动 GitHub Global 项目。

## 前置要求

在开始之前，请确保您的系统已安装以下软件：

- **Node.js** 20.x 或更高版本
  - 下载地址：https://nodejs.org/
  - 验证安装：`node --version`

- **MySQL** 8.0 或更高版本
  - 下载地址：https://dev.mysql.com/downloads/mysql/
  - 验证安装：`mysql --version`

- **Git**（可选）
  - 下载地址：https://git-scm.com/
  - 验证安装：`git --version`

## 项目安装步骤

### 1. 克隆项目

如果您已经有项目代码，请跳过此步骤。

```bash
cd C:\Users\chenxinhao\Desktop\ClaudeCode-LLM-Test\github-global
```

### 2. 安装依赖

```bash
npm install --ignore-scripts
npm run db:generate
```

这将安装所有必需的 npm 包（跳过耗时的 postinstall 脚本），包括：
- Next.js 15.1.11
- React 19
- Prisma
- NextAuth.js
- Octokit（GitHub API 客户端）
- OpenAI SDK（用于 OpenRouter）

> **注意**：使用 `--ignore-scripts` 跳过 postinstall 脚本可以显著加快安装速度，特别是 Prisma 和 Sharp 包的下载。

### 3. 配置环境变量

复制环境变量示例文件：

```bash
# Windows
copy .env.example .env.local
copy .env.local .env

# Linux/Mac
cp .env.example .env.local
cp .env.local .env
```

> **重要**：需要同时创建 `.env` 和 `.env.local` 两个文件：
> - `.env.local` - Next.js 使用
> - `.env` - Prisma CLI 使用

使用文本编辑器打开 `.env.local` 文件，填入实际的配置值。

**必需配置项**：

```bash
# 数据库连接
DATABASE_URL="mysql://root:你的密码@localhost:3306/github_global"

# 加密密钥（生成方法见下方）
ENCRYPTION_KEY="your-64-char-hex-key"

# GitHub OAuth（用于登录）
GITHUB_CLIENT_ID="your_github_oauth_client_id"
GITHUB_CLIENT_SECRET="your_github_oauth_client_secret"
GITHUB_OAUTH_CALLBACK_URL="http://localhost:3000/api/auth/callback"

# GitHub App（用于仓库操作）
GITHUB_APP_ID="your_github_app_id"
GITHUB_APP_NAME="your_github_app_name"
GITHUB_APP_PRIVATE_KEY="-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----"
GITHUB_APP_WEBHOOK_SECRET="your_webhook_secret"

# NextAuth
NEXTAUTH_SECRET="your_nextauth_secret"
NEXTAUTH_URL="http://localhost:3000"

# 应用配置
APP_URL="http://localhost:3000"
APP_NAME="GitHub Global"

# 队列配置
QUEUE_CONCURRENCY=5
```

**生成加密密钥**：

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
```

将生成的 64 字符十六进制字符串填入 `ENCRYPTION_KEY`。

**生成 NextAuth 密钥**：

```bash
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

将生成的字符串填入 `NEXTAUTH_SECRET`。

### 4. 创建 MySQL 数据库

打开 MySQL Command Line Client 或使用您喜欢的 MySQL 客户端工具：

```sql
CREATE DATABASE github_global;
SHOW DATABASES;
```

您应该能看到 `github_global` 数据库已创建。

### 5. 运行数据库迁移

```bash
npx prisma migrate dev --name init
```

这将：
- 在 MySQL 数据库中创建所有必需的表
- 自动生成 Prisma Client（用于数据库操作的 TypeScript 客户端）

> **注意**：`migrate dev` 命令会自动运行 `prisma generate`，无需单独执行。

### 6. 启动开发服务器

```bash
npm run dev
```

您应该看到类似以下输出：

```
   ▲ Next.js 15.1.11
   - Local:        http://localhost:3000
   - Environments: .env.local

 ✓ Ready in 2.3s
```

### 7. 访问应用

打开浏览器，访问：http://localhost:3000

您应该能看到 GitHub Global 的欢迎页面。

## 配置 GitHub 和 OpenRouter

要完整使用所有功能，您还需要配置：

1. **GitHub OAuth** - 用于用户登录
2. **GitHub App** - 用于仓库操作和 Webhook
3. **OpenRouter API** - 用于翻译功能

详细配置步骤请参考：
- [GitHub App 配置指南](./GitHub-App配置指南.md)
- [OpenRouter API 配置指南](./OpenRouter-API配置指南.md)

## 常见问题排查

### 问题 1：数据库连接失败

**错误信息**：`Can't reach database server at localhost:3306`

**解决方案**：
1. 确保 MySQL 服务正在运行
   - Windows：打开服务管理器，检查 MySQL 服务状态
2. 检查 `DATABASE_URL` 中的用户名和密码是否正确
3. 确认 MySQL 运行在 3306 端口

### 问题 2：Prisma 迁移失败

**错误信息**：`Error: P3001`

**解决方案**：
1. 确保 MySQL 数据库 `github_global` 已创建
2. 检查 `DATABASE_URL` 环境变量是否正确
3. 尝试运行：`npx prisma db push`

### 问题 3：GitHub OAuth 回调失败

**错误信息**：`Error: redirect_uri_mismatch`

**解决方案**：
1. 检查 GitHub OAuth App 设置中的 `Authorization callback URL`
2. 确保与 `GITHUB_OAUTH_CALLBACK_URL` 一致
3. URL 应该是：`http://localhost:3000/api/auth/callback`

### 问题 4：Webhook 验证失败

**错误信息**：`Invalid signature`

**解决方案**：
1. 确保 `GITHUB_APP_WEBHOOK_SECRET` 与 GitHub App 中配置的完全一致
2. 检查 Webhook URL 是否正确：`http://your-domain.com/api/webhooks/github`
3. 本地开发时，使用 ngrok 或 smee.io 暴露本地服务

### 问题 5：OpenRouter API 调用失败

**错误信息**：`401 Unauthorized` 或 `Invalid API Key`

**解决方案**：
1. 检查 API Key 是否正确
2. 确保账户有余额（如果使用付费模型）
3. 验证模型名称是否正确（如 `openai/gpt-4-turbo`）

## 开发工具命令

### 数据库相关

```bash
# 查看数据库（Prisma Studio）
npm run db:studio

# 重置数据库（⚠️ 会删除所有数据）
npx prisma migrate reset

# 推送 schema 到数据库（不创建迁移）
npm run db:push
```

### 构建相关

```bash
# 生产环境构建
npm run build

# 启动生产服务器
npm start

# 代码检查
npm run lint
```

## 项目结构

```
github-global/
├── app/                    # Next.js App Router
│   ├── (auth)/            # 认证相关页面
│   ├── (dashboard)/       # Dashboard 页面
│   ├── api/               # API Routes
│   └── globals.css        # 全局样式
├── components/            # React 组件
│   └── ui/                # shadcn/ui 组件
├── lib/                   # 核心业务逻辑
│   ├── auth/              # 认证模块
│   ├── github/            # GitHub API 封装
│   ├── translation/       # 翻译引擎
│   ├── crypto/            # 加密服务
│   └── db/                # 数据库客户端
├── prisma/                # 数据库 Schema
│   └── schema.prisma
├── docs/                  # 文档
└── middleware.ts          # Next.js 中间件
```

## 下一步

完成以上步骤后，您可以：

1. 配置 GitHub OAuth 和 GitHub App
2. 创建您的第一个翻译任务
3. 查看 [项目计划](../.claude/plans/wobbly-inventing-origami.md) 了解完整功能

## 获取帮助

如果遇到问题：

1. 查看本文档的"常见问题排查"部分
2. 检查项目的 GitHub Issues
3. 查阅相关技术文档：
   - Next.js: https://nextjs.org/docs
   - Prisma: https://www.prisma.io/docs
   - GitHub Apps: https://docs.github.com/en/apps
   - OpenRouter: https://openrouter.ai/docs

祝您使用愉快！
